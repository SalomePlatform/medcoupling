#  -*- coding: utf-8 -*-
# Copyright (C) 2025-2026  CEA, EDF
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
#
# See http://www.salome-platform.org/ or email : webmaster.salome@opencascade.com
#

import unittest
from MEDLoader import *


class TestFullParseMeshFile(unittest.TestCase):
    def testMEDMesh(self):
        filename = "sslp200b.mail"

        mm = LoadMailFileInMEDFileUMeshInstance(filename)

        # TEST
        cooRef = DataArrayDouble(
            [
                (1.1719, -3.9841),
                (1.2053, -3.2996),
                (0.39274, -4.0135),
                (0.27334, -2.8774),
                (6.3481, -3.0422),
                (6.4018, -3.6766),
                (5.8828, -3.9439),
                (5.8463, -1.7036),
                (6.3334, -1.7599),
                (6.3709, -2.2853),
                (6.3001, -2.5364),
                (5.8521, -2.8298),
                (5.4915, -3.366),
                (5.5209, -4.0488),
                (5.0595, -3.7113),
                (4.5708, -2.9094),
                (4.5764, -3.4731),
                (4.304, -3.336),
                (3.6394, -2.952),
                (4.1093, -3.7471),
                (3.7705, -3.5505),
                (2.8789, -3.1561),
                (2.9057, -3.8335),
                (2.4289, -4.1005),
                (2.0721, -4.1511),
                (2.0221, -3.5334),
                (1.9554, -3.0492),
                (2.3889, -2.9657),
                (0.035682, 2.5435),
                (0.035682, 1.4339),
                (1.2169, -2.9731),
                (0.16897, -1.2924),
                (0.61519, -2.1557),
                (2.3817, -2.6932),
                (1.9027, -2.7241),
                (1.9435, -2.3129),
                (5.3524, -2.3369),
                (5.4041, -2.9032),
                (4.9846, -2.6244),
                (4.8832, -1.6696),
                (5.3007, -1.7707),
                (4.5154, -1.9571),
                (4.5651, -2.3457),
                (4.1673, -2.3513),
                (3.6424, -1.9793),
                (3.7695, -2.3568),
                (3.3108, -2.5178),
                (2.8521, -2.6787),
                (2.7501, -2.3008),
                (1.5685, 1.9313),
                (0.69262, 2.3427),
                (0.81639, 1.5104),
                (0.11185, -0.12538),
                (0.52124, 0.726),
                (5.9148, 1.0433),
                (6.3319, 1.0628),
                (6.3924, 0.68685),
                (6.235, -1.0874),
                (6.2571, -1.5016),
                (5.7875, -1.4211),
                (5.82, 0.20105),
                (6.4529, 0.31091),
                (6.6643, -0.36993),
                (6.1542, -0.66225),
                (5.6418, -0.72862),
                (4.8639, -1.3735),
                (5.1917, -1.1184),
                (5.2541, -1.4417),
                (0.94968, -0.81413),
                (1.0511, -1.7178),
                (1.9154, -1.296),
                (1.9854, -1.8914),
                (2.3218, -1.9142),
                (3.1417, -1.6623),
                (2.6582, -1.9329),
                (2.7615, -1.2643),
                (3.9904, -1.5852),
                (4.4656, -1.5685),
                (4.3595, -1.1961),
                (3.5525, -1.1918),
                (3.5153, -1.6018),
                (1.7494, 1.013),
                (1.2258, 0.91732),
                (0.9116, -0.067982),
                (1.9054, 1.3753),
                (0.73108, 6.2156),
                (0.57588, 5.2484),
                (0.011667, 2.7945),
                (0.37781, 4.6712),
                (0.24514, 3.9402),
                (0.045203, 3.328),
                (0.83852, 2.6108),
                (1.6887, 2.3437),
                (5.1202, 0.97023),
                (5.4976, 1.0239),
                (5.3424, 0.55755),
                (4.9059, 0.12033),
                (5.1872, 0.091181),
                (5.1582, -0.35191),
                (5.1293, -0.795),
                (4.6913, -0.80935),
                (4.439, -0.33711),
                (4.2534, -0.8237),
                (3.9216, -0.80271),
                (2.3352, -0.82209),
                (1.9154, -0.83857),
                (1.7875, -0.48889),
                (2.8086, -0.36958),
                (2.7549, -0.8056),
                (3.1723, -0.79366),
                (3.5898, -0.78171),
                (3.6217, -0.23353),
                (1.8721, 0.1231),
                (2.2731, 0.23813),
                (2.5889, 1.1917),
                (2.3586, 1.8621),
                (1.5393, 5.8161),
                (1.2311, 6.8924),
                (1.3181, 4.5516),
                (2.4471, 4.9806),
                (1.0068, 3.1845),
                (1.2487, 3.9611),
                (1.8106, 2.8475),
                (2.7508, 2.5785),
                (4.5173, 1.3052),
                (4.8962, 1.0628),
                (4.7603, 0.60613),
                (4.6245, 0.14948),
                (4.1391, 0.23207),
                (3.896, 0.93118),
                (3.6536, 0.31466),
                (3.2579, 0.19055),
                (2.8623, 0.066432),
                (2.9871, 1.0417),
                (3.6393, 1.6142),
                (3.1402, 1.6808),
                (3.2797, 2.2883),
                (2.6676, 5.852),
                (2.2485, 6.6819),
                (3.5073, 5.4211),
                (3.1907, 4.6771),
                (2.873, 3.302),
                (2.9371, 3.8241),
                (2.1682, 3.6945),
                (3.8222, 3.4456),
                (4.1265, 2.8259),
                (3.5779, 2.9095),
                (3.8582, 2.2286),
                (4.4068, 2.145),
                (4.1385, 1.5477),
                (4.4864, 1.3904),
                (4.7547, 1.9877),
                (4.8342, 1.233),
                (5.1678, 1.4126),
                (5.1543, 2.1066),
                (5.6791, 2.0827),
                (5.6334, 1.4709),
                (6.0409, 1.6069),
                (4.0085, 5.666),
                (4.8523, 5.9738),
                (3.8005, 6.112),
                (4.7785, 5.3983),
                (4.2164, 4.6572),
                (4.2164, 5.2201),
                (5.3254, 4.5921),
                (4.6124, 3.8794),
                (4.0666, 3.9817),
                (4.3709, 3.362),
                (5.3547, 3.2733),
                (5.2, 2.7184),
                (4.6752, 2.7423),
                (5.8795, 3.2494),
                (6.1351, 2.1313),
                (5.7248, 2.6945),
                (6.4524, 2.7004),
                (6.5453, 1.568),
                (6.7837, 2.0189),
                (5.6874, 4.6904),
                (5.94, 5.2201),
                (5.3405, 5.5766),
                (6.6071, 3.2553),
                (6.0343, 3.8042),
                (6.1651, 4.3057),
                (7.1799, 2.7064),
                (6.296, 4.8073),
                (6.7081, 4.0192),
                (2.3385, -1.2801),
                (3.157, -1.228),
                (3.956, -1.1939),
                (4.7761, -1.1408),
                (5.7063, -1.0945),
                (2.3878, -2.2048),
                (3.2263, -2.09),
                (4.0789, -1.9682),
                (4.9339, -2.147),
                (5.8825, -2.3082),
                (2.433, -3.371),
                (3.242, -3.0688),
                (4.1127, -2.9089),
                (5.072, -3.1302),
                (6.1277, -3.3147),
            ]
        )
        self.assertTrue(mm.getCoords().isEqual(cooRef, 1e-12))
        self.assertTrue(mm.getName() == "GIBI FECIT")
        self.assertTrue(mm.getNonEmptyLevels() == (0, -1))
        # niveau0
        self.assertTrue(
            [
                MEDCoupling1SGTUMesh(elt).getNumberOfCells()
                for elt in mm[0].splitByType()
            ]
            == [32, 22, 18, 9, 15]
        )
        self.assertTrue(
            [
                MEDCouplingUMesh.GetReprOfGeometricType(
                    MEDCoupling1SGTUMesh(elt).getCellModelEnum()
                )
                for elt in mm[0].splitByType()
            ]
            == ["NORM_TRI3", "NORM_QUAD4", "NORM_TRI6", "NORM_QUAD8", "NORM_QUAD9"]
        )
        self.assertTrue(
            mm[0]
            .getNodalConnectivity()
            .isEqual(
                DataArrayInt(
                    [
                        3,
                        50,
                        29,
                        28,
                        3,
                        29,
                        50,
                        51,
                        3,
                        50,
                        51,
                        81,
                        3,
                        50,
                        49,
                        81,
                        3,
                        29,
                        51,
                        53,
                        3,
                        51,
                        82,
                        53,
                        3,
                        51,
                        82,
                        81,
                        3,
                        29,
                        53,
                        52,
                        3,
                        53,
                        52,
                        83,
                        3,
                        82,
                        53,
                        83,
                        3,
                        83,
                        112,
                        82,
                        3,
                        82,
                        112,
                        81,
                        3,
                        83,
                        52,
                        68,
                        3,
                        83,
                        68,
                        106,
                        3,
                        83,
                        106,
                        112,
                        3,
                        52,
                        31,
                        68,
                        3,
                        68,
                        31,
                        69,
                        3,
                        69,
                        106,
                        68,
                        3,
                        69,
                        105,
                        106,
                        3,
                        69,
                        70,
                        105,
                        3,
                        31,
                        32,
                        69,
                        3,
                        69,
                        70,
                        71,
                        3,
                        31,
                        3,
                        32,
                        3,
                        32,
                        30,
                        69,
                        3,
                        69,
                        30,
                        34,
                        3,
                        69,
                        34,
                        35,
                        3,
                        69,
                        71,
                        35,
                        3,
                        32,
                        3,
                        30,
                        3,
                        3,
                        2,
                        30,
                        3,
                        26,
                        1,
                        25,
                        3,
                        25,
                        0,
                        24,
                        3,
                        1,
                        25,
                        0,
                        4,
                        84,
                        112,
                        113,
                        114,
                        4,
                        113,
                        114,
                        133,
                        132,
                        4,
                        92,
                        115,
                        114,
                        84,
                        4,
                        135,
                        115,
                        114,
                        133,
                        4,
                        90,
                        120,
                        91,
                        87,
                        4,
                        91,
                        120,
                        122,
                        92,
                        4,
                        122,
                        92,
                        115,
                        123,
                        4,
                        123,
                        115,
                        135,
                        136,
                        4,
                        90,
                        120,
                        121,
                        89,
                        4,
                        122,
                        143,
                        121,
                        120,
                        4,
                        143,
                        122,
                        123,
                        141,
                        4,
                        123,
                        136,
                        146,
                        141,
                        4,
                        89,
                        88,
                        118,
                        121,
                        4,
                        121,
                        143,
                        119,
                        118,
                        4,
                        143,
                        142,
                        140,
                        119,
                        4,
                        142,
                        166,
                        162,
                        140,
                        4,
                        88,
                        86,
                        116,
                        118,
                        4,
                        116,
                        137,
                        119,
                        118,
                        4,
                        137,
                        139,
                        140,
                        119,
                        4,
                        117,
                        85,
                        86,
                        116,
                        4,
                        138,
                        117,
                        116,
                        137,
                        4,
                        160,
                        138,
                        137,
                        139,
                        6,
                        140,
                        163,
                        160,
                        162,
                        158,
                        139,
                        6,
                        160,
                        163,
                        179,
                        158,
                        161,
                        159,
                        6,
                        166,
                        181,
                        163,
                        165,
                        164,
                        162,
                        6,
                        163,
                        181,
                        179,
                        164,
                        177,
                        161,
                        6,
                        181,
                        184,
                        179,
                        182,
                        178,
                        177,
                        6,
                        143,
                        146,
                        166,
                        141,
                        144,
                        142,
                        6,
                        170,
                        166,
                        146,
                        167,
                        144,
                        145,
                        6,
                        181,
                        170,
                        166,
                        168,
                        167,
                        165,
                        6,
                        170,
                        173,
                        181,
                        169,
                        171,
                        168,
                        6,
                        181,
                        173,
                        183,
                        171,
                        174,
                        180,
                        6,
                        184,
                        181,
                        183,
                        182,
                        180,
                        185,
                        6,
                        146,
                        135,
                        149,
                        136,
                        134,
                        147,
                        6,
                        170,
                        149,
                        146,
                        148,
                        147,
                        145,
                        6,
                        170,
                        152,
                        149,
                        151,
                        150,
                        148,
                        6,
                        156,
                        152,
                        170,
                        153,
                        151,
                        154,
                        6,
                        170,
                        173,
                        156,
                        169,
                        155,
                        154,
                        6,
                        173,
                        156,
                        175,
                        155,
                        157,
                        172,
                        6,
                        175,
                        183,
                        173,
                        176,
                        174,
                        172,
                        8,
                        135,
                        132,
                        130,
                        149,
                        133,
                        131,
                        129,
                        134,
                        8,
                        149,
                        130,
                        127,
                        125,
                        129,
                        128,
                        126,
                        124,
                        8,
                        125,
                        127,
                        97,
                        94,
                        126,
                        96,
                        95,
                        93,
                        8,
                        94,
                        97,
                        61,
                        55,
                        95,
                        60,
                        56,
                        54,
                        8,
                        132,
                        112,
                        105,
                        108,
                        113,
                        106,
                        104,
                        107,
                        8,
                        132,
                        130,
                        110,
                        108,
                        131,
                        111,
                        109,
                        107,
                        8,
                        127,
                        130,
                        110,
                        102,
                        128,
                        111,
                        103,
                        101,
                        8,
                        127,
                        102,
                        99,
                        97,
                        101,
                        100,
                        98,
                        96,
                        8,
                        97,
                        99,
                        63,
                        61,
                        98,
                        64,
                        62,
                        60,
                        9,
                        108,
                        74,
                        71,
                        105,
                        75,
                        72,
                        70,
                        104,
                        186,
                        9,
                        108,
                        74,
                        80,
                        110,
                        75,
                        73,
                        79,
                        109,
                        187,
                        9,
                        80,
                        110,
                        102,
                        77,
                        79,
                        103,
                        78,
                        76,
                        188,
                        9,
                        67,
                        99,
                        102,
                        77,
                        66,
                        100,
                        78,
                        65,
                        189,
                        9,
                        99,
                        67,
                        58,
                        63,
                        66,
                        59,
                        57,
                        64,
                        190,
                        9,
                        71,
                        34,
                        47,
                        74,
                        35,
                        33,
                        48,
                        72,
                        191,
                        9,
                        80,
                        74,
                        47,
                        45,
                        73,
                        48,
                        46,
                        44,
                        192,
                        9,
                        77,
                        80,
                        45,
                        42,
                        76,
                        44,
                        43,
                        41,
                        193,
                        9,
                        40,
                        77,
                        42,
                        37,
                        39,
                        41,
                        38,
                        36,
                        194,
                        9,
                        37,
                        10,
                        8,
                        40,
                        11,
                        9,
                        7,
                        36,
                        195,
                        9,
                        47,
                        26,
                        24,
                        22,
                        27,
                        25,
                        23,
                        21,
                        196,
                        9,
                        47,
                        22,
                        19,
                        45,
                        21,
                        20,
                        18,
                        46,
                        197,
                        9,
                        45,
                        19,
                        16,
                        42,
                        18,
                        17,
                        15,
                        43,
                        198,
                        9,
                        42,
                        16,
                        13,
                        37,
                        15,
                        14,
                        12,
                        38,
                        199,
                        9,
                        10,
                        37,
                        13,
                        5,
                        11,
                        12,
                        6,
                        4,
                        200,
                    ]
                )
            )
        )
        self.assertTrue(
            mm[0]
            .getNodalConnectivityIndex()
            .isEqual(
                DataArrayInt(
                    [
                        0,
                        4,
                        8,
                        12,
                        16,
                        20,
                        24,
                        28,
                        32,
                        36,
                        40,
                        44,
                        48,
                        52,
                        56,
                        60,
                        64,
                        68,
                        72,
                        76,
                        80,
                        84,
                        88,
                        92,
                        96,
                        100,
                        104,
                        108,
                        112,
                        116,
                        120,
                        124,
                        128,
                        133,
                        138,
                        143,
                        148,
                        153,
                        158,
                        163,
                        168,
                        173,
                        178,
                        183,
                        188,
                        193,
                        198,
                        203,
                        208,
                        213,
                        218,
                        223,
                        228,
                        233,
                        238,
                        245,
                        252,
                        259,
                        266,
                        273,
                        280,
                        287,
                        294,
                        301,
                        308,
                        315,
                        322,
                        329,
                        336,
                        343,
                        350,
                        357,
                        364,
                        373,
                        382,
                        391,
                        400,
                        409,
                        418,
                        427,
                        436,
                        445,
                        455,
                        465,
                        475,
                        485,
                        495,
                        505,
                        515,
                        525,
                        535,
                        545,
                        555,
                        565,
                        575,
                        585,
                        595,
                    ]
                )
            )
        )
        self.assertTrue(
            [
                MEDCoupling1SGTUMesh(elt).getNumberOfCells()
                for elt in mm[-1].splitByType()
            ]
            == [26, 26]
        )
        self.assertTrue(
            [
                MEDCouplingUMesh.GetReprOfGeometricType(
                    MEDCoupling1SGTUMesh(elt).getCellModelEnum()
                )
                for elt in mm[-1].splitByType()
            ]
            == ["NORM_SEG2", "NORM_SEG3"]
        )

        self.assertTrue(
            mm[-1]
            .getNodalConnectivity()
            .isEqual(
                DataArrayInt(
                    [
                        1,
                        24,
                        0,
                        1,
                        0,
                        1,
                        1,
                        1,
                        26,
                        1,
                        34,
                        30,
                        1,
                        30,
                        2,
                        1,
                        2,
                        3,
                        1,
                        3,
                        31,
                        1,
                        31,
                        52,
                        1,
                        52,
                        29,
                        1,
                        29,
                        28,
                        1,
                        28,
                        50,
                        1,
                        50,
                        49,
                        1,
                        49,
                        81,
                        1,
                        81,
                        112,
                        1,
                        112,
                        84,
                        1,
                        84,
                        92,
                        1,
                        92,
                        91,
                        1,
                        91,
                        87,
                        1,
                        87,
                        90,
                        1,
                        90,
                        89,
                        1,
                        89,
                        88,
                        1,
                        88,
                        86,
                        1,
                        86,
                        85,
                        1,
                        85,
                        117,
                        1,
                        117,
                        138,
                        1,
                        138,
                        160,
                        2,
                        160,
                        179,
                        159,
                        2,
                        179,
                        184,
                        178,
                        2,
                        184,
                        183,
                        185,
                        2,
                        183,
                        175,
                        176,
                        2,
                        175,
                        156,
                        157,
                        2,
                        156,
                        152,
                        153,
                        2,
                        152,
                        149,
                        150,
                        2,
                        149,
                        125,
                        124,
                        2,
                        125,
                        94,
                        93,
                        2,
                        94,
                        55,
                        54,
                        2,
                        55,
                        61,
                        56,
                        2,
                        61,
                        63,
                        62,
                        2,
                        63,
                        58,
                        57,
                        2,
                        58,
                        67,
                        59,
                        2,
                        67,
                        77,
                        65,
                        2,
                        77,
                        40,
                        39,
                        2,
                        40,
                        8,
                        7,
                        2,
                        8,
                        10,
                        9,
                        2,
                        10,
                        5,
                        4,
                        2,
                        5,
                        13,
                        6,
                        2,
                        13,
                        16,
                        14,
                        2,
                        16,
                        19,
                        17,
                        2,
                        19,
                        22,
                        20,
                        2,
                        22,
                        24,
                        23,
                        2,
                        26,
                        47,
                        27,
                        2,
                        47,
                        34,
                        33,
                    ]
                )
            )
        )

        self.assertTrue(
            mm[-1]
            .getNodalConnectivityIndex()
            .isEqual(
                DataArrayInt(
                    [
                        0,
                        3,
                        6,
                        9,
                        12,
                        15,
                        18,
                        21,
                        24,
                        27,
                        30,
                        33,
                        36,
                        39,
                        42,
                        45,
                        48,
                        51,
                        54,
                        57,
                        60,
                        63,
                        66,
                        69,
                        72,
                        75,
                        78,
                        82,
                        86,
                        90,
                        94,
                        98,
                        102,
                        106,
                        110,
                        114,
                        118,
                        122,
                        126,
                        130,
                        134,
                        138,
                        142,
                        146,
                        150,
                        154,
                        158,
                        162,
                        166,
                        170,
                        174,
                        178,
                        182,
                    ]
                )
            )
        )

        self.assertTrue(mm.getMeshDimension() == 2)
        # Test Groupe of nodes
        self.assertTrue(mm.getGrpNonEmptyLevelsExt("GXXXXXX_GNO1") == (1,))
        for elt in (
            "GXXXXXX_GNO1",
            "GXXXXXX_GNO2",
            "GXXXXXX_GNO3",
            "GXXXXXX_GNO4",
            "GXXXXXX_GNO5",
            "GXXXXXX_GNO6",
            "GXXXXXX_GNO7",
            "GXXXXXX_GNO8",
            "GXXXXXX_GNO9",
            "N199",
            "N168",
            "N103",
            "N143",
            "N130",
            "N97",
            "N145",
            "N110",
            "N85",
            "N38",
            "N111",
            "N195",
            "N109",
            "N156",
            "N104",
            "N30",
            "N137",
            "N76",
            "N37",
            "N145_N168",
        ):
            self.assertTrue(mm.getGrpNonEmptyLevelsExt(elt) == (1,))

        self.assertTrue(
            mm.getGroupArr(1, "GXXXXXX_GNO1").isEqualWithoutConsideringStr(
                DataArrayInt([111, 123])
            )
        )
        self.assertTrue(
            mm.getGroupArr(1, "GXXXXXX_GNO3").isEqualWithoutConsideringStr(
                DataArrayInt([44])
            )
        )
        self.assertTrue(
            mm.getGroupArr(1, "N199").isEqualWithoutConsideringStr(DataArrayInt([198]))
        )

        #  Test Groupe of mesh
        self.assertTrue(mm.getGrpNonEmptyLevelsExt("GXXXXXX_GMA0") == (0,))
        self.assertTrue(
            mm.getGroupArr(0, "GXXXXXX_GMA0").isEqualWithoutConsideringStr(
                DataArrayInt(
                    [
                        0,
                        1,
                        2,
                        3,
                        4,
                        41,
                        42,
                        43,
                        44,
                        45,
                        60,
                        61,
                        62,
                        63,
                        64,
                        73,
                        74,
                        75,
                        76,
                        77,
                        88,
                        89,
                        90,
                        91,
                        92,
                    ]
                )
            )
        )
        for elt in (
            "GXXXXXX_GMA0",
            "GXXXXXX_GMA1",
            "GXXXXXX_GMA10",
            "GXXXXXX_GMA11",
            "GXXXXXX_GMA12",
            "GXXXXXX_GMA2",
            "GXXXXXX_GMA6",
            "GXXXXXX_GMA8",
            "GXXXXXX_GMA9",
            "GXXXXXX_LESQUAD4",
            "M24",
            "M31",
            "M42",
            "M44",
            "M54",
            "M67",
            "M71",
            "M77",
            "M87",
            "M88",
        ):
            self.assertTrue(mm.getGrpNonEmptyLevelsExt(elt) == (0,))

        for elt in (
            "GXXXXXX_GMA3",
            "GXXXXXX_GMA4",
            "GXXXXXX_GMA5",
            "M101",
            "M120",
            "M126",
            "M135",
            "M99",
        ):
            self.assertTrue(mm.getGrpNonEmptyLevelsExt(elt) == (-1,))

        self.assertTrue(
            mm.getGroupArr(-1, "GXXXXXX_GMA3").isEqualWithoutConsideringStr(
                DataArrayInt([26])
            )
        )

        for elt in ("GXXXXXX_GMA7",):
            self.assertTrue(mm.getGrpNonEmptyLevelsExt(elt) == (0, -1))

        self.assertTrue(
            mm.getGroupArr(0, "GXXXXXX_GMA7").isEqualWithoutConsideringStr(
                DataArrayInt([69])
            )
        )
        self.assertTrue(
            mm.getGroupArr(-1, "GXXXXXX_GMA7").isEqualWithoutConsideringStr(
                DataArrayInt([19])
            )
        )

    def testMEDMeshSec(self):
        filename = "quad9.mail"

        mm = LoadMailFileInMEDFileUMeshInstance(filename)

        # TEST
        cooRef = DataArrayDouble(
            [
                (-1.0, -1.0, 3.0),
                (1.0, -1.0, 3.0),
                (1.0, 1.0, 3.0),
                (-1.0, 1.0, 3.0),
                (-0.0, -1.0, 3.0),
                (1.0, -0.0, 3.0),
                (-0.0, 1.0, 3.0),
                (-1.0, -0.0, 3.0),
                (0.0, -0.0, 3.0),
            ]
        )
        self.assertTrue(mm.getCoords().isEqual(cooRef, 1e-12))
        self.assertTrue(mm.getName() == "AUTEUR = H. RAZGALLAH")
        self.assertTrue(mm.getNonEmptyLevels() == (0,))
        # niveau0
        self.assertTrue(
            [
                MEDCoupling1SGTUMesh(elt).getNumberOfCells()
                for elt in mm[0].splitByType()
            ]
            == [4, 1, 1]
        )
        self.assertTrue(
            [
                MEDCouplingUMesh.GetReprOfGeometricType(
                    MEDCoupling1SGTUMesh(elt).getCellModelEnum()
                )
                for elt in mm[0].splitByType()
            ]
            == ["NORM_QUAD4", "NORM_QUAD8", "NORM_QUAD9"]
        )
        self.assertTrue(
            mm[0]
            .getNodalConnectivity()
            .isEqual(
                DataArrayInt(
                    [
                        4,
                        0,
                        4,
                        8,
                        7,
                        4,
                        4,
                        1,
                        5,
                        8,
                        4,
                        8,
                        5,
                        2,
                        6,
                        4,
                        7,
                        8,
                        6,
                        3,
                        8,
                        0,
                        1,
                        2,
                        3,
                        4,
                        5,
                        6,
                        7,
                        9,
                        0,
                        1,
                        2,
                        3,
                        4,
                        5,
                        6,
                        7,
                        8,
                    ]
                )
            )
        )
        self.assertTrue(
            mm[0]
            .getNodalConnectivityIndex()
            .isEqual(DataArrayInt([0, 5, 10, 15, 20, 29, 39]))
        )

        self.assertTrue(mm.getMeshDimension() == 2)
        # Test Groups
        self.assertTrue(mm.getGrpNonEmptyLevelsExt("gauche") == (0,))
        for elt in ("gauche", "gauche_et_quad8", "gauche_et_quad8_et_quad9"):
            self.assertTrue(mm.getGrpNonEmptyLevelsExt(elt) == (0,))

        self.assertTrue(
            mm.getGroupArr(0, "gauche").isEqualWithoutConsideringStr(
                DataArrayInt([0, 3])
            )
        )
        self.assertTrue(
            mm.getGroupArr(0, "gauche_et_quad8").isEqualWithoutConsideringStr(
                DataArrayInt([0, 3, 4])
            )
        )
        self.assertTrue(
            mm.getGroupArr(0, "gauche_et_quad8_et_quad9").isEqualWithoutConsideringStr(
                DataArrayInt([0, 3, 4, 5])
            )
        )

    def testMEDMeshWrongName(self):
        filename = "WrongGrpName.mail"
        try:
            mm = LoadMailFileInMEDFileUMeshInstance(filename)
            assert False, "Expected ValueError not raised"
        except ValueError as e:
            assert "Group name 'les_seg2' is missing or badly formatted." in str(e)

    def testHexa20(self):
        """
        [EDF32699] : Fix connectiviy for MED_PENTA15, MED_PENTA18, MED_HEXA20, MED_HEXA27
        """
        import tempfile
        from pathlib import Path

        mailFileBaseName = "testHexa20.mail"
        FileContent = """TITRE
TEST_HEXA20
FINSF

COOR_3D
N1  0.000000000000000E+00 0.000000000000000E+00 0.000000000000000E+00
N2  1.000000000000000E+00 0.000000000000000E+00 0.000000000000000E+00
N3  0.000000000000000E+00 1.000000000000000E+00 0.000000000000000E+00
N4  1.000000000000000E+00 1.000000000000000E+00 0.000000000000000E+00
N5  0.000000000000000E+00 0.000000000000000E+00 1.000000000000000E+00
N6  1.000000000000000E+00 0.000000000000000E+00 1.000000000000000E+00
N7  0.000000000000000E+00 1.000000000000000E+00 1.000000000000000E+00
N8  1.000000000000000E+00 1.000000000000000E+00 1.000000000000000E+00
N9  5.000000000000000E-01 0.000000000000000E+00 0.000000000000000E+00
N10  0.000000000000000E+00 5.000000000000000E-01 0.000000000000000E+00
N11  5.000000000000000E-01 1.000000000000000E+00 0.000000000000000E+00
N12  1.000000000000000E+00 5.000000000000000E-01 0.000000000000000E+00
N13  5.000000000000000E-01 0.000000000000000E+00 1.000000000000000E+00
N14  0.000000000000000E+00 5.000000000000000E-01 1.000000000000000E+00
N15  5.000000000000000E-01 1.000000000000000E+00 1.000000000000000E+00
N16  1.000000000000000E+00 5.000000000000000E-01 1.000000000000000E+00
N17  1.000000000000000E+00 0.000000000000000E+00 5.000000000000000E-01
N18  0.000000000000000E+00 0.000000000000000E+00 5.000000000000000E-01
N19  0.000000000000000E+00 1.000000000000000E+00 5.000000000000000E-01
N20  1.000000000000000E+00 1.000000000000000E+00 5.000000000000000E-01
FINSF

HEXA20
M1     N1 N2 N4 N3 N5 N6 N8
      N7 N9 N12 N11 N10 N18
      N17 N20 N19 N13 N16
      N15 N14
FINSF

FIN
"""
        with tempfile.TemporaryDirectory() as tmpdirname:
            mailFile = str((Path(tmpdirname) / mailFileBaseName).absolute())
            with open(mailFile, "w") as f:
                f.write(FileContent)
            mm = LoadMailFileInMEDFileUMeshInstance(mailFile)
            self.assertTrue(mm.getMeshDimension() == 3)
            cooRef = DataArrayDouble(
                [
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    1.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    1.0,
                    0.0,
                    1.0,
                    0.0,
                    1.0,
                    1.0,
                    1.0,
                    1.0,
                    1.0,
                    0.5,
                    0.0,
                    0.0,
                    0.0,
                    0.5,
                    0.0,
                    0.5,
                    1.0,
                    0.0,
                    1.0,
                    0.5,
                    0.0,
                    0.5,
                    0.0,
                    1.0,
                    0.0,
                    0.5,
                    1.0,
                    0.5,
                    1.0,
                    1.0,
                    1.0,
                    0.5,
                    1.0,
                    1.0,
                    0.0,
                    0.5,
                    0.0,
                    0.0,
                    0.5,
                    0.0,
                    1.0,
                    0.5,
                    1.0,
                    1.0,
                    0.5,
                ],
                20,
                3,
            )
            self.assertTrue(mm.getCoords().isEqual(cooRef, 1e-12))
            self.assertTrue(
                mm[0]
                .getNodalConnectivity()
                .isEqual(
                    DataArrayInt(
                        [
                            30,
                            0,
                            2,
                            3,
                            1,
                            4,
                            6,
                            7,
                            5,
                            9,
                            10,
                            11,
                            8,
                            13,
                            14,
                            15,
                            12,
                            17,
                            18,
                            19,
                            16,
                        ]
                    )
                )
            )


if __name__ == "__main__":
    unittest.main()
